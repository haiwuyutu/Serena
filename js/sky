// éŸ³é¢‘ç®¡ç†å™¨ - å¤„ç†æ‰€æœ‰å‘éŸ³åŠŸèƒ½
class AudioManager {
    constructor() {
        this.audioContext = null;
        this.isPlaying = false;
        this.currentAudio = null;
        this.volume = 0.7;
        this.pinyinData = this.loadPinyinData();
        this.init();
    }

    init() {
        // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡ï¼ˆå…¼å®¹ä¸åŒæµè§ˆå™¨ï¼‰
        try {
            window.AudioContext = window.AudioContext || window.webkitAudioContext;
            this.audioContext = new AudioContext();
        } catch (e) {
            console.warn('Web Audio API ä¸æ”¯æŒï¼Œå°†ä½¿ç”¨TTS');
        }
    }

    loadPinyinData() {
        return {
            shengmu: [
                { char: 'b', audio: 'b' }, { char: 'p', audio: 'p' },
                { char: 'm', audio: 'm' }, { char: 'f', audio: 'f' },
                { char: 'd', audio: 'd' }, { char: 't', audio: 't' },
                { char: 'n', audio: 'n' }, { char: 'l', audio: 'l' },
                { char: 'g', audio: 'g' }, { char: 'k', audio: 'k' },
                { char: 'h', audio: 'h' }, { char: 'j', audio: 'j' },
                { char: 'q', audio: 'q' }, { char: 'x', audio: 'x' },
                { char: 'zh', audio: 'zh' }, { char: 'ch', audio: 'ch' },
                { char: 'sh', audio: 'sh' }, { char: 'r', audio: 'r' },
                { char: 'z', audio: 'z' }, { char: 'c', audio: 'c' },
                { char: 's', audio: 's' }, { char: 'y', audio: 'y' },
                { char: 'w', audio: 'w' }
            ],
            yunmu: [
                { char: 'a', audio: 'a' }, { char: 'o', audio: 'o' },
                { char: 'e', audio: 'e' }, { char: 'i', audio: 'i' },
                { char: 'u', audio: 'u' }, { char: 'Ã¼', audio: 'v' },
                { char: 'ai', audio: 'ai' }, { char: 'ei', audio: 'ei' },
                { char: 'ui', audio: 'ui' }, { char: 'ao', audio: 'ao' },
                { char: 'ou', audio: 'ou' }, { char: 'iu', audio: 'iu' },
                { char: 'ie', audio: 'ie' }, { char: 'Ã¼e', audio: 've' },
                { char: 'er', audio: 'er' }, { char: 'an', audio: 'an' },
                { char: 'en', audio: 'en' }, { char: 'in', audio: 'in' },
                { char: 'un', audio: 'un' }, { char: 'Ã¼n', audio: 'vn' },
                { char: 'ang', audio: 'ang' }, { char: 'eng', audio: 'eng' },
                { char: 'ing', audio: 'ing' }, { char: 'ong', audio: 'ong' }
            ],
            tones: [
                { char: 'mÄ', audio: 'ma1' }, { char: 'mÃ¡', audio: 'ma2' },
                { char: 'mÇ', audio: 'ma3' }, { char: 'mÃ ', audio: 'ma4' },
                { char: 'bÄ', audio: 'ba1' }, { char: 'bÃ¡', audio: 'ba2' },
                { char: 'bÇ', audio: 'ba3' }, { char: 'bÃ ', audio: 'ba4' },
                { char: 'fÅ«', audio: 'fu1' }, { char: 'fÃº', audio: 'fu2' },
                { char: 'fÇ”', audio: 'fu3' }, { char: 'fÃ¹', audio: 'fu4' }
            ]
        };
    }

    // æ’­æ”¾æ‹¼éŸ³å‘éŸ³
    playPinyin(pinyin) {
        if (!pinyin) return;
        
        this.stopPlayback();
        
        // å¦‚æœæ˜¯ä¸­æ–‡TTS
        if ('speechSynthesis' in window) {
            this.playWithTTS(pinyin);
        } else {
            this.playWithAudio(pinyin);
        }
    }

    playWithTTS(pinyin) {
        this.isPlaying = true;
        this.updatePlayButton();
        
        const utterance = new SpeechSynthesisUtterance(pinyin);
        utterance.lang = 'zh-CN';
        utterance.rate = 0.8;
        utterance.pitch = 1;
        utterance.volume = this.volume;
        
        utterance.onstart = () => {
            this.startProgressAnimation();
        };
        
        utterance.onend = () => {
            this.isPlaying = false;
            this.updatePlayButton();
            this.resetProgress();
        };
        
        utterance.onerror = (event) => {
            console.error('TTSé”™è¯¯:', event);
            this.isPlaying = false;
            this.updatePlayButton();
            this.resetProgress();
            this.showAudioError();
        };
        
        speechSynthesis.speak(utterance);
        this.currentAudio = utterance;
    }

    playWithAudio(pinyin) {
        // è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰éŸ³é¢‘æ–‡ä»¶çš„æ’­æ”¾é€»è¾‘
        // ç”±äºGitHub Pagesä¸èƒ½ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨TTS
        console.log('æ’­æ”¾éŸ³é¢‘:', pinyin);
        this.showAudioError();
    }

    // å½•åˆ¶ç”¨æˆ·éŸ³é¢‘
    async recordAudio() {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            this.showNotification('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒå½•éŸ³åŠŸèƒ½', 'error');
            return;
        }

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            this.showNotification('å½•éŸ³å¼€å§‹ï¼Œè¯·è·Ÿè¯»æ‹¼éŸ³...', 'info');
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ å½•éŸ³å¤„ç†é€»è¾‘
            setTimeout(() => {
                this.showNotification('å½•éŸ³å®Œæˆï¼', 'success');
                // åœæ­¢å½•éŸ³
                stream.getTracks().forEach(track => track.stop());
            }, 3000);
            
        } catch (error) {
            console.error('å½•éŸ³é”™è¯¯:', error);
            this.showNotification('æ— æ³•è®¿é—®éº¦å…‹é£', 'error');
        }
    }

    // æ§åˆ¶æ–¹æ³•
    togglePlay() {
        if (this.isPlaying) {
            this.stopPlayback();
        } else {
            const currentPinyin = document.getElementById('currentPinyin').textContent;
            if (currentPinyin && currentPinyin !== 'ç‚¹å‡»ç”Ÿæˆæ‹¼éŸ³') {
                this.playPinyin(currentPinyin);
            } else {
                this.showNotification('è¯·å…ˆç”Ÿæˆæ‹¼éŸ³', 'warning');
            }
        }
    }

    stopPlayback() {
        if (this.currentAudio && 'cancel' in this.currentAudio) {
            speechSynthesis.cancel();
        }
        this.isPlaying = false;
        this.updatePlayButton();
        this.resetProgress();
    }

    repeatPlay(times = 3) {
        const currentPinyin = document.getElementById('currentPinyin').textContent;
        if (!currentPinyin || currentPinyin === 'ç‚¹å‡»ç”Ÿæˆæ‹¼éŸ³') {
            this.showNotification('è¯·å…ˆç”Ÿæˆæ‹¼éŸ³', 'warning');
            return;
        }

        let count = 0;
        const playNext = () => {
            if (count >= times) return;
            
            setTimeout(() => {
                this.playPinyin(currentPinyin);
                count++;
                
                if (count < times) {
                    setTimeout(playNext, 1500);
                }
            }, 500);
        };
        
        playNext();
    }

    // å·¥å…·æ–¹æ³•
    updatePlayButton() {
        const playIcon = document.getElementById('playIcon');
        const playText = document.getElementById('playText');
        
        if (this.isPlaying) {
            playIcon.className = 'fas fa-pause';
            playText.textContent = 'æš‚åœ';
        } else {
            playIcon.className = 'fas fa-play';
            playText.textContent = 'æ’­æ”¾';
        }
    }

    startProgressAnimation() {
        const progressBar = document.getElementById('audioProgress');
        progressBar.style.width = '0%';
        
        let width = 0;
        const interval = setInterval(() => {
            if (width >= 100 || !this.isPlaying) {
                clearInterval(interval);
                return;
            }
            width += 1;
            progressBar.style.width = width + '%';
        }, 30);
    }

    resetProgress() {
        document.getElementById('audioProgress').style.width = '0%';
    }

    changeVolume(value) {
        this.volume = value / 100;
        if (this.currentAudio && this.currentAudio.volume !== undefined) {
            this.currentAudio.volume = this.volume;
        }
    }

    // æ˜¾ç¤ºé€šçŸ¥
    showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            ${message}
        `;
        
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 10000;
            animation: slideIn 0.3s, fadeOut 0.3s 2.7s;
            border-left: 4px solid ${type === 'success' ? '#4CAF50' : type === 'error' ? '#F44336' : '#2196F3'};
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'fadeOut 0.3s';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    showAudioError() {
        this.showNotification('éŸ³é¢‘æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®æˆ–å°è¯•å…¶ä»–æ‹¼éŸ³', 'error');
    }
}

// åˆ›å»ºå…¨å±€éŸ³é¢‘ç®¡ç†å™¨å®ä¾‹
const audioManager = new AudioManager();// æ‹¼éŸ³æ¸¸æˆå¼•æ“
class PinyinGame {
    constructor() {
        this.score = 0;
        this.currentQuestion = 0;
        this.totalQuestions = 10;
        this.questions = this.generateQuestions();
        this.stars = 0;
        this.init();
    }

    init() {
        this.updateDisplay();
        this.loadQuestion();
    }

    generateQuestions() {
        return [
            {
                type: 'tone',
                question: "æ‹¼éŸ³ 'mÄ' æ˜¯ç¬¬å‡ å£°ï¼Ÿ",
                answer: "1",
                options: ["1", "2", "3", "4"],
                pinyin: "mÄ"
            },
            {
                type: 'shengmu',
                question: "å“ªä¸ªæ˜¯å£°æ¯ï¼Ÿ",
                answer: "b",
                options: ["a", "b", "i", "u"],
                pinyin: "b"
            },
            {
                type: 'yunmu',
                question: "å“ªä¸ªæ˜¯éŸµæ¯ï¼Ÿ",
                answer: "a",
                options: ["b", "p", "a", "m"],
                pinyin: "a"
            },
            {
                type: 'match',
                question: "å£°æ¯ 'b' å’ŒéŸµæ¯ 'a' ç»„æˆä»€ä¹ˆï¼Ÿ",
                answer: "ba",
                options: ["ba", "pa", "bi", "bo"],
                pinyin: "ba"
            },
            {
                type: 'tone',
                question: "æ‹¼éŸ³ 'mÃ ' æ˜¯ç¬¬å‡ å£°ï¼Ÿ",
                answer: "4",
                options: ["1", "2", "3", "4"],
                pinyin: "mÃ "
            },
            {
                type: 'shengmu',
                question: "ä¸‹é¢å“ªä¸ªä¸æ˜¯å£°æ¯ï¼Ÿ",
                answer: "e",
                options: ["d", "t", "e", "n"],
                pinyin: "e"
            },
            {
                type: 'yunmu',
                question: "éŸµæ¯ 'ang' æ€ä¹ˆè¯»ï¼Ÿ",
                answer: "ang",
                options: ["an", "ang", "eng", "ong"],
                pinyin: "ang"
            },
            {
                type: 'match',
                question: "'p' + 'o' ç»„æˆä»€ä¹ˆï¼Ÿ",
                answer: "po",
                options: ["po", "bo", "pu", "pa"],
                pinyin: "po"
            },
            {
                type: 'tone',
                question: "æ‹¼éŸ³ 'mÇ' æ˜¯ç¬¬å‡ å£°ï¼Ÿ",
                answer: "3",
                options: ["1", "2", "3", "4"],
                pinyin: "mÇ"
            },
            {
                type: 'complete',
                question: "å£°æ¯ 'g' + éŸµæ¯ 'u' + ç¬¬3å£° = ï¼Ÿ",
                answer: "gÇ”",
                options: ["gÅ«", "gÃº", "gÇ”", "gÃ¹"],
                pinyin: "gÇ”"
            }
        ];
    }

    loadQuestion() {
        if (this.currentQuestion >= this.questions.length) {
            this.endGame();
            return;
        }

        const question = this.questions[this.currentQuestion];
        document.getElementById('gameQuestion').innerHTML = `
            <div style="margin-bottom: 20px;">${question.question}</div>
            <div style="font-size: 2em; color: var(--dawn-gold);">${question.pinyin}</div>
        `;

        const optionsContainer = document.getElementById('gameOptions');
        optionsContainer.innerHTML = '';
        
        question.options.forEach(option => {
            const button = document.createElement('button');
            button.className = 'option-btn';
            button.innerHTML = option;
            button.onclick = () => this.checkAnswer(option, question.answer);
            optionsContainer.appendChild(button);
        });

        document.getElementById('nextBtn').disabled = true;
        this.updateProgress();
    }

    checkAnswer(selected, correct) {
        const buttons = document.querySelectorAll('.option-btn');
        let isCorrect = false;

        buttons.forEach(button => {
            if (button.textContent === correct) {
                button.classList.add('correct');
                if (button.textContent === selected) {
                    isCorrect = true;
                }
            }
            if (button.textContent === selected && button.textContent !== correct) {
                button.classList.add('wrong');
            }
            button.disabled = true;
        });

        if (isCorrect) {
            this.score++;
            this.stars += 10;
            this.showNotification('ğŸ‰ å›ç­”æ­£ç¡®ï¼è·å¾—10é¢—æ˜Ÿæ˜Ÿ', 'success');
            audioManager.playPinyin(this.questions[this.currentQuestion].pinyin);
        } else {
            this.showNotification('æ­£ç¡®ç­”æ¡ˆæ˜¯: ' + correct, 'error');
        }

        document.getElementById('nextBtn').disabled = false;
        this.updateDisplay();
    }

    nextQuestion() {
        this.currentQuestion++;
        if (this.currentQuestion < this.questions.length) {
            this.loadQuestion();
        } else {
            this.endGame();
        }
    }

    endGame() {
        const message = `
            <div style="text-align: center; padding: 30px;">
                <h3 style="color: var(--dawn-gold);">ğŸ® æ¸¸æˆå®Œæˆï¼</h3>
                <p>æœ€ç»ˆå¾—åˆ†: <span style="font-size: 2em; color: var(--cloud-pink);">${this.score}/${this.totalQuestions}</span></p>
                <p>è·å¾—æ˜Ÿæ˜Ÿ: <span style="color: var(--dawn-gold);">${this.stars} âœ¨</span></p>
                <button class="sky-btn" onclick="resetGame()" style="margin-top: 20px;">
                    <i class="fas fa-redo"></i> å†ç©ä¸€æ¬¡
                </button>
            </div>
        `;
        
        document.getElementById('gameQuestion').innerHTML = message;
        document.getElementById('gameOptions').innerHTML = '';
        document.getElementById('nextBtn').style.display = 'none';
        
        // åº†ç¥æ•ˆæœ
        this.celebrate();
    }

    celebrate() {
        // æ·»åŠ åº†ç¥åŠ¨ç”»
        for(let i = 0; i < 50; i++) {
            setTimeout(() => {
                const star = document.createElement('div');
                star.innerHTML = 'âœ¨';
                star.style.cssText = `
                    position: fixed;
                    font-size: 24px;
                    left: ${Math.random() * 100}vw;
                    top: -50px;
                    animation: fall 3s linear forwards;
                    z-index: 1000;
                    pointer-events: none;
                `;
                document.body.appendChild(star);
                setTimeout(() => star.remove(), 3000);
            }, i * 100);
        }
    }

    resetGame() {
        this.score = 0;
        this.currentQuestion = 0;
        this.stars = 0;
        this.questions = this.generateQuestions();
        document.getElementById('nextBtn').style.display = 'inline-block';
        this.updateDisplay();
        this.loadQuestion();
    }

    updateDisplay() {
        document.getElementById('starCount').textContent = this.stars;
        document.getElementById('progressText').textContent = 
            `${this.currentQuestion + 1}/${this.totalQuestions}`;
    }

    updateProgress() {
        const progress = ((this.currentQuestion + 1) / this.totalQuestions) * 100;
        document.getElementById('gameProgress').style.width = progress + '%';
    }

    showNotification(message, type) {
        // å¤ç”¨éŸ³é¢‘ç®¡ç†å™¨çš„é€šçŸ¥ç³»ç»Ÿ
        if (window.audioManager) {
            audioManager.showNotification(message, type);
        }
    }
}

// åˆ›å»ºæ¸¸æˆå®ä¾‹
let pinyinGame;

function initGame() {
    pinyinGame = new PinyinGame();
}

function resetGame() {
    pinyinGame.resetGame();
}

function nextQuestion() {
    pinyinGame.nextQuestion();
}// ä¸»æ§åˆ¶è„šæœ¬ - æ•´åˆæ‰€æœ‰åŠŸèƒ½

// åˆå§‹åŒ–æ˜Ÿå…‰èƒŒæ™¯
function initStars() {
    const starsBg = document.getElementById('starsBg');
    const starCount = 150;
    
    for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        
        // éšæœºå¤§å°
        const size = Math.random() * 3 + 1;
        star.style.width = size + 'px';
        star.style.height = size + 'px';
        
        // éšæœºä½ç½®
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        
        // éšæœºé—ªçƒå»¶è¿Ÿ
        star.style.animationDelay = Math.random() * 4 + 's';
        
        starsBg.appendChild(star);
    }
}

// æ»šåŠ¨åˆ°æŒ‡å®šåŒºåŸŸ
function scrollToSection(sectionId) {
    const element = document.getElementById(sectionId);
    if (element) {
        element.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });
    }
}

// åˆ‡æ¢æš—è‰²æ¨¡å¼
function toggleDarkMode() {
    const body = document.body;
    const isDark = body.classList.toggle('dark-mode');
    
    const icon = document.querySelector('[onclick="toggleDarkMode()"] i');
    icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
    
    showNotification(isDark ? 'åˆ‡æ¢åˆ°å…‰æ˜æ¨¡å¼' : 'åˆ‡æ¢åˆ°æ˜Ÿç©ºæ¨¡å¼', 'info');
}

// å­¦ä¹ éƒ¨åˆ†
function learnSection(type) {
    let message = '';
    let pinyin = '';
    
    switch(type) {
        case 'shengmu':
            message = 'å¼€å§‹å­¦ä¹ å£°æ¯<br>å£°æ¯æ˜¯æ‹¼éŸ³çš„å¼€å¤´éƒ¨åˆ†ï¼Œå…±æœ‰23ä¸ª';
            pinyin = 'b p m f d t n l g k h j q x zh ch sh r z c s y w';
            break;
        case 'yunmu':
            message = 'å¼€å§‹å­¦ä¹ éŸµæ¯<br>éŸµæ¯æ˜¯æ‹¼éŸ³çš„ä¸»è¦å‘éŸ³éƒ¨åˆ†ï¼Œå…±æœ‰24ä¸ª';
            pinyin = 'a o e i u Ã¼ ai ei ui ao ou iu ie Ã¼e er an en in un Ã¼n ang eng ing ong';
            break;
        case 'shengdiao':
            message = 'å¼€å§‹å­¦ä¹ å£°è°ƒ<br>æ±‰è¯­æœ‰å››ä¸ªå£°è°ƒï¼Œå†³å®šå­—çš„æ„æ€';
            pinyin = 'mÄ mÃ¡ mÇ mÃ ';
            break;
    }
    
    showNotification(message, 'info');
    document.getElementById('currentPinyin').innerHTML = pinyin.split(' ').map(p => 
        `<span class="pinyin-char" onclick="playAudio('${p}')">${p}</span>`
    ).join(' ');
    
    // æ’­æ”¾ç¬¬ä¸€ä¸ªæ‹¼éŸ³
    if (pinyin) {
        const firstPinyin = pinyin.split(' ')[0];
        setTimeout(() => playAudio(firstPinyin), 500);
    }
}

// æ’­æ”¾éŸ³é¢‘ï¼ˆåŒ…è£…å‡½æ•°ï¼‰
function playAudio(pinyin) {
    if (window.audioManager) {
        audioManager.playPinyin(pinyin);
    }
}

function playCurrentPinyin() {
    const current = document.getElementById('currentPinyin').textContent;
    if (current && current !== 'ç‚¹å‡»ç”Ÿæˆæ‹¼éŸ³') {
        playAudio(current);
    }
}

function repeatPlay() {
    if (window.audioManager) {
        audioManager.repeatPlay();
    }
}

function togglePlay() {
    if (window.audioManager) {
        audioManager.togglePlay();
    }
}

function recordAudio() {
    if (window.audioManager) {
        audioManager.recordAudio();
    }
}

function changeVolume(value) {
    if (window.audioManager) {
        audioManager.changeVolume(value);
    }
}

// ç”Ÿæˆéšæœºæ‹¼éŸ³
function generateRandomPinyin() {
    const shengmu = ['b', 'p', 'm', 'f', 'd', 't', 'n', 'l', 'g', 'k', 'h', 'j', 'q', 'x'];
    const yunmu = ['a', 'o', 'e', 'i', 'u', 'Ã¼', 'ai', 'ei', 'ao', 'ou', 'an', 'en', 'ang', 'eng'];
    const tones = ['', 'Ì„', 'Ì', 'ÌŒ', 'Ì€']; // æ— å£°è°ƒ, 1å£°, 2å£°, 3å£°, 4å£°
    const toneNames = ['', 'Â¹', 'Â²', 'Â³', 'â´'];
    
    const s = shengmu[Math.floor(Math.random() * shengmu.length)];
    const y = yunmu[Math.floor(Math.random() * yunmu.length)];
    const toneIndex = Math.floor(Math.random() * tones.length);
    
    let pinyin = s + y;
    if (toneIndex > 0) {
        pinyin = s + y + tones[toneIndex];
    }
    
    const displayText = toneIndex > 0 ? 
        `${s}${y}${toneNames[toneIndex]}` : 
        `${s}${y}`;
    
    document.getElementById('currentPinyin').innerHTML = 
        `<span class="pinyin-char" onclick="playAudio('${s}${y}')">${displayText}</span>`;
    
    showNotification(`ç”Ÿæˆæ‹¼éŸ³: ${displayText}`, 'info');
}

// é‡Šæ”¾æ˜Ÿå…‰ç‰¹æ•ˆ
function showStars() {
    for(let i = 0; i < 30; i++) {
        setTimeout(() => {
            const star = document.createElement('div');
            star.innerHTML = 'âœ¨';
            star.style.cssText = `
                position: fixed;
                font-size: 28px;
                left: ${Math.random() * 100}vw;
                top: 100vh;
                animation: flyUp 3s linear forwards;
                z-index: 1000;
                pointer-events: none;
                opacity: 0.8;
            `;
            document.body.appendChild(star);
            setTimeout(() => star.remove(), 3000);
        }, i * 100);
    }
    
    // æ·»åŠ CSSåŠ¨ç”»
    const style = document.createElement('style');
    style.textContent = `
        @keyframes flyUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }
    `;
    document.head.appendChild(style);
}

// åˆ†äº«ç½‘ç«™
function shareSite() {
    const url = 'https://haiwuyutu.github.io/Serena/';
    const text = 'æ¥çœ‹çœ‹è¿™ä¸ªè¶…ç¾çš„å…‰é‡é£æ ¼æ‹¼éŸ³å­¦ä¹ ç½‘ç«™ï¼âœ¨';
    
    if (navigator.share) {
        navigator.share({
            title: 'æ‹¼éŸ³æ˜Ÿæ²³',
            text: text,
            url: url
        });
    } else {
        navigator.clipboard.writeText(url).then(() => {
            showNotification('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
        });
    }
}

// æ˜¾ç¤ºé€šçŸ¥ï¼ˆå…¼å®¹æ€§ï¼‰
function showNotification(message, type = 'info') {
    if (window.audioManager && audioManager.showNotification) {
        audioManager.showNotification(message, type);
    } else {
        alert(message);
    }
}

// æ·»åŠ CSSåŠ¨ç”»
document.head.insertAdjacentHTML('beforeend', `
    <style>
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .dark-mode {
            filter: invert(1) hue-rotate(180deg);
        }
    </style>
`);