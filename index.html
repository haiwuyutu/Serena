<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹¼éŸ³å­¦ä¹ åŠ©æ‰‹ - äº’åŠ¨éŸ³é¢‘ç‰ˆ</title>
    <link rel="stylesheet" href="css/audio-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“¢</text></svg>">
</head>
<body>
    <div class="audio-container">
        <!-- å¤´éƒ¨ -->
        <header class="audio-header">
            <h1 class="audio-title">
                <i class="fas fa-volume-up"></i>
                æ‹¼éŸ³å­¦ä¹ åŠ©æ‰‹
                <i class="fas fa-headphones"></i>
            </h1>
            <p class="audio-subtitle">ç‚¹å‡»ä»»æ„æ‹¼éŸ³å³å¯å¬åˆ°æ ‡å‡†å‘éŸ³ ğŸ”Š æ”¯æŒå½•éŸ³å¯¹æ¯”è·Ÿè¯»</p>
        </header>

        <!-- éŸ³é¢‘æ§åˆ¶é¢æ¿ -->
        <section class="audio-control-panel">
            <h2 class="control-title">
                <i class="fas fa-sliders-h"></i>
                éŸ³é¢‘æ§åˆ¶ä¸­å¿ƒ
            </h2>
            
            <div class="control-buttons">
                <button class="control-btn" onclick="playAllShengmu()">
                    <i class="fas fa-play-circle"></i>
                    æ’­æ”¾æ‰€æœ‰å£°æ¯
                </button>
                <button class="control-btn" onclick="playTonePractice()">
                    <i class="fas fa-music"></i>
                    å£°è°ƒç»ƒä¹  (mÄ mÃ¡ mÇ mÃ )
                </button>
                <button class="control-btn" onclick="playRandomPinyin()">
                    <i class="fas fa-random"></i>
                    éšæœºæ’­æ”¾æ‹¼éŸ³
                </button>
                <button class="control-btn record" onclick="toggleRecording()" id="recordBtn">
                    <i class="fas fa-microphone"></i>
                    <span id="recordText">å¼€å§‹å½•éŸ³</span>
                </button>
                <button class="control-btn stop" onclick="stopAllAudio()">
                    <i class="fas fa-stop-circle"></i>
                    åœæ­¢æ’­æ”¾
                </button>
            </div>
            
            <div class="now-playing" id="nowPlaying">
                <i class="fas fa-volume-up"></i> å‡†å¤‡æ’­æ”¾æ‹¼éŸ³...
            </div>
            
            <div class="audio-tip">
                <i class="fas fa-lightbulb"></i> 
                <strong>ä½¿ç”¨æç¤ºï¼š</strong> é¦–æ¬¡ä½¿ç”¨å¯èƒ½éœ€è¦å…è®¸æµè§ˆå™¨æ’­æ”¾å£°éŸ³ã€‚å»ºè®®ä½¿ç”¨ Chrome/Edge æµè§ˆå™¨è·å¾—æœ€ä½³ä½“éªŒã€‚
            </div>
        </section>

        <!-- å£°æ¯å‘éŸ³åŒº -->
        <section class="pinyin-section">
            <h2 class="section-title">
                <i class="fas fa-volume-up"></i>
                å£°æ¯å‘éŸ³ (21ä¸ª)
            </h2>
            <p>ç‚¹å‡»ä¸‹æ–¹å£°æ¯æŒ‰é’®å³å¯å¬åˆ°å‘éŸ³ï¼š</p>
            <div class="pinyin-grid" id="shengmuGrid">
                <!-- åŠ¨æ€ç”Ÿæˆå£°æ¯æŒ‰é’® -->
            </div>
        </section>

        <!-- éŸµæ¯å‘éŸ³åŒº -->
        <section class="pinyin-section">
            <h2 class="section-title">
                <i class="fas fa-music"></i>
                éŸµæ¯å‘éŸ³
            </h2>
            <p>ç‚¹å‡»ä¸‹æ–¹éŸµæ¯æŒ‰é’®å³å¯å¬åˆ°å‘éŸ³ï¼š</p>
            <div class="pinyin-grid" id="yunmuGrid">
                <!-- åŠ¨æ€ç”ŸæˆéŸµæ¯æŒ‰é’® -->
            </div>
        </section>

        <!-- å£°è°ƒç»ƒä¹ åŒº -->
        <section class="pinyin-section">
            <h2 class="section-title">
                <i class="fas fa-chart-line"></i>
                å››å£°è°ƒç»ƒä¹ 
            </h2>
            <p>ç‚¹å‡»ç»ƒä¹ å››ä¸ªå£°è°ƒï¼Œä½“ä¼šå£°è°ƒå˜åŒ–ï¼š</p>
            <div class="tone-buttons">
                <button class="tone-btn" onclick="playPinyin('mÄ')">mÄ <br><small>ç¬¬ä¸€å£°</small></button>
                <button class="tone-btn" onclick="playPinyin('mÃ¡')">mÃ¡ <br><small>ç¬¬äºŒå£°</small></button>
                <button class="tone-btn" onclick="playPinyin('mÇ')">mÇ <br><small>ç¬¬ä¸‰å£°</small></button>
                <button class="tone-btn" onclick="playPinyin('mÃ ')">mÃ  <br><small>ç¬¬å››å£°</small></button>
            </div>
        </section>

        <!-- å¸¸ç”¨è¯å‘éŸ³ -->
        <section class="pinyin-section">
            <h2 class="section-title">
                <i class="fas fa-comments"></i>
                å¸¸ç”¨è¯å‘éŸ³
            </h2>
            <p>ç‚¹å‡»å­¦ä¹ å¸¸ç”¨æ±‰è¯­è¯æ±‡çš„å‘éŸ³ï¼š</p>
            <div class="words-grid">
                <button class="word-btn" onclick="playWord('ä½ å¥½')">ä½ å¥½</button>
                <button class="word-btn" onclick="playWord('è°¢è°¢')">è°¢è°¢</button>
                <button class="word-btn" onclick="playWord('å†è§')">å†è§</button>
                <button class="word-btn" onclick="playWord('æˆ‘çˆ±ä½ ')">æˆ‘çˆ±ä½ </button>
                <button class="word-btn" onclick="playWord('æ—©ä¸Šå¥½')">æ—©ä¸Šå¥½</button>
                <button class="word-btn" onclick="playWord('å¯¹ä¸èµ·')">å¯¹ä¸èµ·</button>
                <button class="word-btn" onclick="playWord('æ²¡å…³ç³»')">æ²¡å…³ç³»</button>
                <button class="word-btn" onclick="playWord('è€å¸ˆå¥½')">è€å¸ˆå¥½</button>
            </div>
        </section>

        <!-- å½•éŸ³å¯¹æ¯”åŒº -->
        <section class="record-section">
            <h2 class="section-title">
                <i class="fas fa-microphone-alt"></i>
                å½•éŸ³è·Ÿè¯»ç»ƒä¹ 
            </h2>
            <p>ç‚¹å‡»"å¼€å§‹å½•éŸ³"æŒ‰é’®ï¼Œè·Ÿè¯»æ‹¼éŸ³ï¼Œç„¶åæ’­æ”¾å¯¹æ¯”æ‚¨çš„å‘éŸ³ï¼š</p>
            
            <div class="waveform" id="waveform">
                <!-- åŠ¨æ€ç”Ÿæˆæ³¢å½¢ -->
            </div>
            
            <div id="recordStatus" style="text-align: center; margin: 15px 0; color: var(--primary-audio);">
                <i class="fas fa-info-circle"></i> å‡†å¤‡å½•éŸ³...
            </div>
            
            <audio id="userRecording" controls style="width: 100%; margin-top: 10px;"></audio>
            
            <div class="audio-tip">
                <i class="fas fa-graduation-cap"></i>
                <strong>å­¦ä¹ å»ºè®®ï¼š</strong> å…ˆå¬æ ‡å‡†å‘éŸ³ï¼Œç„¶åå½•éŸ³è·Ÿè¯»ï¼Œå¯¹æ¯”æ”¹è¿›ã€‚æ¯å¤©ç»ƒä¹ 10åˆ†é’Ÿæ•ˆæœæœ€ä½³ï¼
            </div>
        </section>

        <!-- é¡µè„š -->
        <footer class="audio-footer">
            <p>ğŸ¯ æ‹¼éŸ³å­¦ä¹ åŠ©æ‰‹ - äº’åŠ¨éŸ³é¢‘ç‰ˆ v1.0</p>
            <p>ğŸ“ æŠ€æœ¯æ”¯æŒï¼šæµè§ˆå™¨è¯­éŸ³åˆæˆ(TTS) | ğŸµ æ‰€æœ‰å‘éŸ³å‡ä¸ºå®æ—¶ç”Ÿæˆ</p>
            <p>â­ æç¤ºï¼šå¦‚æœå¬ä¸åˆ°å£°éŸ³ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®å¹¶å…è®¸æ’­æ”¾å£°éŸ³</p>
        </footer>
    </div>

    <!-- è„šæœ¬ -->
    <script src="js/audio-manager.js"></script>
    <script>
        // ==================== åˆå§‹åŒ–æ‹¼éŸ³æ•°æ® ====================
        const pinyinData = {
            shengmu: [
                'b', 'p', 'm', 'f', 'd', 't', 'n', 'l', 
                'g', 'k', 'h', 'j', 'q', 'x', 
                'zh', 'ch', 'sh', 'r', 'z', 'c', 's'
            ],
            yunmu: [
                'a', 'o', 'e', 'i', 'u', 'Ã¼', 
                'ai', 'ei', 'ao', 'ou', 
                'an', 'en', 'in', 'un', 'Ã¼n',
                'ang', 'eng', 'ing', 'ong'
            ]
        };

        // ==================== åˆå§‹åŒ–é¡µé¢ ====================
        document.addEventListener('DOMContentLoaded', function() {
            initPinyinButtons();
            initWaveform();
            initSpeechSynthesis();
            
            // æ˜¾ç¤ºæ¬¢è¿æç¤º
            setTimeout(() => {
                document.getElementById('nowPlaying').innerHTML = 
                    '<i class="fas fa-hand-pointer"></i> ç‚¹å‡»ä¸Šæ–¹ä»»æ„æ‹¼éŸ³å¼€å§‹å­¦ä¹ ï¼';
            }, 1000);
        });

        // åˆå§‹åŒ–æ‹¼éŸ³æŒ‰é’®
        function initPinyinButtons() {
            // ç”Ÿæˆå£°æ¯æŒ‰é’®
            const shengmuGrid = document.getElementById('shengmuGrid');
            shengmuGrid.innerHTML = pinyinData.shengmu.map(pinyin => `
                <button class="pinyin-btn" onclick="playPinyin('${pinyin}')">
                    ${pinyin}
                </button>
            `).join('');
            
            // ç”ŸæˆéŸµæ¯æŒ‰é’®
            const yunmuGrid = document.getElementById('yunmuGrid');
            yunmuGrid.innerHTML = pinyinData.yunmu.map(pinyin => `
                <button class="pinyin-btn" onclick="playPinyin('${pinyin}')">
                    ${pinyin}
                </button>
            `).join('');
        }

        // åˆå§‹åŒ–æ³¢å½¢å›¾
        function initWaveform() {
            const waveform = document.getElementById('waveform');
            for (let i = 0; i < 40; i++) {
                const bar = document.createElement('div');
                bar.className = 'wave-bar';
                bar.style.left = `${i * 2.5}%`;
                bar.style.animationDelay = `${i * 0.05}s`;
                waveform.appendChild(bar);
            }
        }

        // åˆå§‹åŒ–è¯­éŸ³åˆæˆ
        function initSpeechSynthesis() {
            if ('speechSynthesis' in window) {
                // é¢„åŠ è½½è¯­éŸ³
                speechSynthesis.getVoices();
                console.log('è¯­éŸ³åˆæˆå·²å°±ç»ª');
            } else {
                console.warn('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ');
                document.querySelector('.audio-tip').innerHTML += 
                    '<br><strong style="color: red;">âš ï¸ å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆï¼Œè¯·ä½¿ç”¨ Chrome æˆ– Edge æµè§ˆå™¨ã€‚</strong>';
            }
        }

        // ==================== éŸ³é¢‘æ§åˆ¶å‡½æ•° ====================
        function playPinyin(pinyin) {
            if (window.audioManager) {
                window.audioManager.playPinyin(pinyin);
            }
        }

        function playWord(word) {
            playPinyin(word);
        }

        function playAllShengmu() {
            if (window.audioManager) {
                window.audioManager.playAllShengmu();
            }
        }

        function playTonePractice() {
            if (window.audioManager) {
                window.audioManager.playTonePractice();
            }
        }

        function playRandomPinyin() {
            const allPinyin = [...pinyinData.shengmu, ...pinyinData.yunmu, 'mÄ', 'mÃ¡', 'mÇ', 'mÃ '];
            const randomPinyin = allPinyin[Math.floor(Math.random() * allPinyin.length)];
            playPinyin(randomPinyin);
        }

        function stopAllAudio() {
            if (window.audioManager) {
                window.audioManager.stopCurrent();
                document.getElementById('nowPlaying').innerHTML = 
                    '<i class="fas fa-stop-circle"></i> å·²åœæ­¢æ‰€æœ‰æ’­æ”¾';
            }
        }

        // ==================== å½•éŸ³åŠŸèƒ½ ====================
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];

        async function toggleRecording() {
            const btn = document.getElementById('recordBtn');
            const text = document.getElementById('recordText');
            const status = document.getElementById('recordStatus');
            
            if (!isRecording) {
                // å¼€å§‹å½•éŸ³
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            sampleRate: 44100
                        }
                    });
                    
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = event => {
                        if (event.data.size > 0) {
                            audioChunks.push(event.data);
                        }
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        const audioElement = document.getElementById('userRecording');
                        
                        audioElement.src = audioUrl;
                        audioElement.style.display = 'block';
                        
                        // åœæ­¢æ‰€æœ‰éŸ³é¢‘æµ
                        stream.getTracks().forEach(track => track.stop());
                        
                        status.innerHTML = '<i class="fas fa-check-circle"></i> å½•éŸ³å®Œæˆï¼ç‚¹å‡»æ’­æ”¾æŒ‰é’®æ”¶å¬æ‚¨çš„å½•éŸ³';
                        status.style.color = 'var(--success-audio)';
                    };
                    
                    mediaRecorder.onerror = (event) => {
                        console.error('å½•éŸ³é”™è¯¯:', event);
                        status.innerHTML = '<i class="fas fa-exclamation-triangle"></i> å½•éŸ³å¤±è´¥ï¼Œè¯·é‡è¯•';
                        status.style.color = 'var(--danger-audio)';
                    };
                    
                    mediaRecorder.start();
                    isRecording = true;
                    
                    // æ›´æ–°UI
                    btn.innerHTML = '<i class="fas fa-stop-circle"></i> åœæ­¢å½•éŸ³';
                    text.textContent = 'åœæ­¢å½•éŸ³';
                    btn.classList.add('stop');
                    status.innerHTML = '<i class="fas fa-circle" style="color: red; animation: blink 1s infinite;"></i> æ­£åœ¨å½•éŸ³...';
                    status.style.color = 'var(--danger-audio)';
                    
                    // æ·»åŠ é—ªçƒåŠ¨ç”»
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes blink {
                            0%, 100% { opacity: 1; }
                            50% { opacity: 0.5; }
                        }
                    `;
                    document.head.appendChild(style);
                    
                } catch (err) {
                    console.error('å½•éŸ³å¤±è´¥:', err);
                    status.innerHTML = `<i class="fas fa-exclamation-triangle"></i> æ— æ³•è®¿é—®éº¦å…‹é£: ${err.message}`;
                    status.style.color = 'var(--danger-audio)';
                    
                    // å›é€€åˆ°æç¤º
                    alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·ç¡®ä¿å·²æˆäºˆå½•éŸ³æƒé™ã€‚\n\næ‚¨å¯ä»¥ç»§ç»­ç‚¹å‡»æ‹¼éŸ³è¿›è¡Œå¬éŸ³å­¦ä¹ ã€‚');
                }
            } else {
                // åœæ­¢å½•éŸ³
                if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                    mediaRecorder.stop();
                }
                
                isRecording = false;
                btn.innerHTML = '<i class="fas fa-microphone"></i> å¼€å§‹å½•éŸ³';
                text.textContent = 'å¼€å§‹å½•éŸ³';
                btn.classList.remove('stop');
            }
        }

        // ==================== é”®ç›˜å¿«æ·é”® ====================
        document.addEventListener('keydown', function(event) {
            // ç©ºæ ¼é”®åœæ­¢æ’­æ”¾
            if (event.code === 'Space') {
                event.preventDefault();
                stopAllAudio();
            }
            // ESCé”®åœæ­¢å½•éŸ³
            if (event.code === 'Escape' && isRecording) {
                toggleRecording();
            }
            // Ré”®éšæœºæ’­æ”¾
            if (event.code === 'KeyR' && event.ctrlKey) {
                playRandomPinyin();
            }
        });

        // ==================== æœåŠ¡Workerï¼ˆå¢å¼ºä½“éªŒï¼‰ ====================
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(err => {
                console.log('Service Worker æ³¨å†Œå¤±è´¥:', err);
            });
        }
    </script>
</body>
</html>
EOFcat > index.html << 'EOF'
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹¼éŸ³å­¦ä¹ åŠ©æ‰‹ - äº’åŠ¨éŸ³é¢‘ç‰ˆ</title>
    <link rel="stylesheet" href="css/audio-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“¢</text></svg>">
</head>
<body>
    <div class="audio-container">
        <!-- å¤´éƒ¨ -->
        <header class="audio-header">
            <h1 class="audio-title">
                <i class="fas fa-volume-up"></i>
                æ‹¼éŸ³å­¦ä¹ åŠ©æ‰‹
                <i class="fas fa-headphones"></i>
            </h1>
            <p class="audio-subtitle">ç‚¹å‡»ä»»æ„æ‹¼éŸ³å³å¯å¬åˆ°æ ‡å‡†å‘éŸ³ ğŸ”Š æ”¯æŒå½•éŸ³å¯¹æ¯”è·Ÿè¯»</p>
        </header>

        <!-- éŸ³é¢‘æ§åˆ¶é¢æ¿ -->
        <section class="audio-control-panel">
            <h2 class="control-title">
                <i class="fas fa-sliders-h"></i>
                éŸ³é¢‘æ§åˆ¶ä¸­å¿ƒ
            </h2>
            
            <div class="control-buttons">
                <button class="control-btn" onclick="playAllShengmu()">
                    <i class="fas fa-play-circle"></i>
                    æ’­æ”¾æ‰€æœ‰å£°æ¯
                </button>
                <button class="control-btn" onclick="playTonePractice()">
                    <i class="fas fa-music"></i>
                    å£°è°ƒç»ƒä¹  (mÄ mÃ¡ mÇ mÃ )
                </button>
                <button class="control-btn" onclick="playRandomPinyin()">
                    <i class="fas fa-random"></i>
                    éšæœºæ’­æ”¾æ‹¼éŸ³
                </button>
                <button class="control-btn record" onclick="toggleRecording()" id="recordBtn">
                    <i class="fas fa-microphone"></i>
                    <span id="recordText">å¼€å§‹å½•éŸ³</span>
                </button>
                <button class="control-btn stop" onclick="stopAllAudio()">
                    <i class="fas fa-stop-circle"></i>
                    åœæ­¢æ’­æ”¾
                </button>
            </div>
            
            <div class="now-playing" id="nowPlaying">
                <i class="fas fa-volume-up"></i> å‡†å¤‡æ’­æ”¾æ‹¼éŸ³...
            </div>
            
            <div class="audio-tip">
                <i class="fas fa-lightbulb"></i> 
                <strong>ä½¿ç”¨æç¤ºï¼š</strong> é¦–æ¬¡ä½¿ç”¨å¯èƒ½éœ€è¦å…è®¸æµè§ˆå™¨æ’­æ”¾å£°éŸ³ã€‚å»ºè®®ä½¿ç”¨ Chrome/Edge æµè§ˆå™¨è·å¾—æœ€ä½³ä½“éªŒã€‚
            </div>
        </section>

        <!-- å£°æ¯å‘éŸ³åŒº -->
        <section class="pinyin-section">
            <h2 class="section-title">
                <i class="fas fa-volume-up"></i>
                å£°æ¯å‘éŸ³ (21ä¸ª)
            </h2>
            <p>ç‚¹å‡»ä¸‹æ–¹å£°æ¯æŒ‰é’®å³å¯å¬åˆ°å‘éŸ³ï¼š</p>
            <div class="pinyin-grid" id="shengmuGrid">
                <!-- åŠ¨æ€ç”Ÿæˆå£°æ¯æŒ‰é’® -->
            </div>
        </section>

        <!-- éŸµæ¯å‘éŸ³åŒº -->
        <section class="pinyin-section">
            <h2 class="section-title">
                <i class="fas fa-music"></i>
                éŸµæ¯å‘éŸ³
            </h2>
            <p>ç‚¹å‡»ä¸‹æ–¹éŸµæ¯æŒ‰é’®å³å¯å¬åˆ°å‘éŸ³ï¼š</p>
            <div class="pinyin-grid" id="yunmuGrid">
                <!-- åŠ¨æ€ç”ŸæˆéŸµæ¯æŒ‰é’® -->
            </div>
        </section>

        <!-- å£°è°ƒç»ƒä¹ åŒº -->
        <section class="pinyin-section">
            <h2 class="section-title">
                <i class="fas fa-chart-line"></i>
                å››å£°è°ƒç»ƒä¹ 
            </h2>
            <p>ç‚¹å‡»ç»ƒä¹ å››ä¸ªå£°è°ƒï¼Œä½“ä¼šå£°è°ƒå˜åŒ–ï¼š</p>
            <div class="tone-buttons">
                <button class="tone-btn" onclick="playPinyin('mÄ')">mÄ <br><small>ç¬¬ä¸€å£°</small></button>
                <button class="tone-btn" onclick="playPinyin('mÃ¡')">mÃ¡ <br><small>ç¬¬äºŒå£°</small></button>
                <button class="tone-btn" onclick="playPinyin('mÇ')">mÇ <br><small>ç¬¬ä¸‰å£°</small></button>
                <button class="tone-btn" onclick="playPinyin('mÃ ')">mÃ  <br><small>ç¬¬å››å£°</small></button>
            </div>
        </section>

        <!-- å¸¸ç”¨è¯å‘éŸ³ -->
        <section class="pinyin-section">
            <h2 class="section-title">
                <i class="fas fa-comments"></i>
                å¸¸ç”¨è¯å‘éŸ³
            </h2>
            <p>ç‚¹å‡»å­¦ä¹ å¸¸ç”¨æ±‰è¯­è¯æ±‡çš„å‘éŸ³ï¼š</p>
            <div class="words-grid">
                <button class="word-btn" onclick="playWord('ä½ å¥½')">ä½ å¥½</button>
                <button class="word-btn" onclick="playWord('è°¢è°¢')">è°¢è°¢</button>
                <button class="word-btn" onclick="playWord('å†è§')">å†è§</button>
                <button class="word-btn" onclick="playWord('æˆ‘çˆ±ä½ ')">æˆ‘çˆ±ä½ </button>
                <button class="word-btn" onclick="playWord('æ—©ä¸Šå¥½')">æ—©ä¸Šå¥½</button>
                <button class="word-btn" onclick="playWord('å¯¹ä¸èµ·')">å¯¹ä¸èµ·</button>
                <button class="word-btn" onclick="playWord('æ²¡å…³ç³»')">æ²¡å…³ç³»</button>
                <button class="word-btn" onclick="playWord('è€å¸ˆå¥½')">è€å¸ˆå¥½</button>
            </div>
        </section>

        <!-- å½•éŸ³å¯¹æ¯”åŒº -->
        <section class="record-section">
            <h2 class="section-title">
                <i class="fas fa-microphone-alt"></i>
                å½•éŸ³è·Ÿè¯»ç»ƒä¹ 
            </h2>
            <p>ç‚¹å‡»"å¼€å§‹å½•éŸ³"æŒ‰é’®ï¼Œè·Ÿè¯»æ‹¼éŸ³ï¼Œç„¶åæ’­æ”¾å¯¹æ¯”æ‚¨çš„å‘éŸ³ï¼š</p>
            
            <div class="waveform" id="waveform">
                <!-- åŠ¨æ€ç”Ÿæˆæ³¢å½¢ -->
            </div>
            
            <div id="recordStatus" style="text-align: center; margin: 15px 0; color: var(--primary-audio);">
                <i class="fas fa-info-circle"></i> å‡†å¤‡å½•éŸ³...
            </div>
            
            <audio id="userRecording" controls style="width: 100%; margin-top: 10px;"></audio>
            
            <div class="audio-tip">
                <i class="fas fa-graduation-cap"></i>
                <strong>å­¦ä¹ å»ºè®®ï¼š</strong> å…ˆå¬æ ‡å‡†å‘éŸ³ï¼Œç„¶åå½•éŸ³è·Ÿè¯»ï¼Œå¯¹æ¯”æ”¹è¿›ã€‚æ¯å¤©ç»ƒä¹ 10åˆ†é’Ÿæ•ˆæœæœ€ä½³ï¼
            </div>
        </section>

        <!-- é¡µè„š -->
        <footer class="audio-footer">
            <p>ğŸ¯ æ‹¼éŸ³å­¦ä¹ åŠ©æ‰‹ - äº’åŠ¨éŸ³é¢‘ç‰ˆ v1.0</p>
            <p>ğŸ“ æŠ€æœ¯æ”¯æŒï¼šæµè§ˆå™¨è¯­éŸ³åˆæˆ(TTS) | ğŸµ æ‰€æœ‰å‘éŸ³å‡ä¸ºå®æ—¶ç”Ÿæˆ</p>
            <p>â­ æç¤ºï¼šå¦‚æœå¬ä¸åˆ°å£°éŸ³ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®å¹¶å…è®¸æ’­æ”¾å£°éŸ³</p>
        </footer>
    </div>

    <!-- è„šæœ¬ -->
    <script src="js/audio-manager.js"></script>
    <script>
        // ==================== åˆå§‹åŒ–æ‹¼éŸ³æ•°æ® ====================
        const pinyinData = {
            shengmu: [
                'b', 'p', 'm', 'f', 'd', 't', 'n', 'l', 
                'g', 'k', 'h', 'j', 'q', 'x', 
                'zh', 'ch', 'sh', 'r', 'z', 'c', 's'
            ],
            yunmu: [
                'a', 'o', 'e', 'i', 'u', 'Ã¼', 
                'ai', 'ei', 'ao', 'ou', 
                'an', 'en', 'in', 'un', 'Ã¼n',
                'ang', 'eng', 'ing', 'ong'
            ]
        };

        // ==================== åˆå§‹åŒ–é¡µé¢ ====================
        document.addEventListener('DOMContentLoaded', function() {
            initPinyinButtons();
            initWaveform();
            initSpeechSynthesis();
            
            // æ˜¾ç¤ºæ¬¢è¿æç¤º
            setTimeout(() => {
                document.getElementById('nowPlaying').innerHTML = 
                    '<i class="fas fa-hand-pointer"></i> ç‚¹å‡»ä¸Šæ–¹ä»»æ„æ‹¼éŸ³å¼€å§‹å­¦ä¹ ï¼';
            }, 1000);
        });

        // åˆå§‹åŒ–æ‹¼éŸ³æŒ‰é’®
        function initPinyinButtons() {
            // ç”Ÿæˆå£°æ¯æŒ‰é’®
            const shengmuGrid = document.getElementById('shengmuGrid');
            shengmuGrid.innerHTML = pinyinData.shengmu.map(pinyin => `
                <button class="pinyin-btn" onclick="playPinyin('${pinyin}')">
                    ${pinyin}
                </button>
            `).join('');
            
            // ç”ŸæˆéŸµæ¯æŒ‰é’®
            const yunmuGrid = document.getElementById('yunmuGrid');
            yunmuGrid.innerHTML = pinyinData.yunmu.map(pinyin => `
                <button class="pinyin-btn" onclick="playPinyin('${pinyin}')">
                    ${pinyin}
                </button>
            `).join('');
        }

        // åˆå§‹åŒ–æ³¢å½¢å›¾
        function initWaveform() {
            const waveform = document.getElementById('waveform');
            for (let i = 0; i < 40; i++) {
                const bar = document.createElement('div');
                bar.className = 'wave-bar';
                bar.style.left = `${i * 2.5}%`;
                bar.style.animationDelay = `${i * 0.05}s`;
                waveform.appendChild(bar);
            }
        }

        // åˆå§‹åŒ–è¯­éŸ³åˆæˆ
        function initSpeechSynthesis() {
            if ('speechSynthesis' in window) {
                // é¢„åŠ è½½è¯­éŸ³
                speechSynthesis.getVoices();
                console.log('è¯­éŸ³åˆæˆå·²å°±ç»ª');
            } else {
                console.warn('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ');
                document.querySelector('.audio-tip').innerHTML += 
                    '<br><strong style="color: red;">âš ï¸ å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆï¼Œè¯·ä½¿ç”¨ Chrome æˆ– Edge æµè§ˆå™¨ã€‚</strong>';
            }
        }

        // ==================== éŸ³é¢‘æ§åˆ¶å‡½æ•° ====================
        function playPinyin(pinyin) {
            if (window.audioManager) {
                window.audioManager.playPinyin(pinyin);
            }
        }

        function playWord(word) {
            playPinyin(word);
        }

        function playAllShengmu() {
            if (window.audioManager) {
                window.audioManager.playAllShengmu();
            }
        }

        function playTonePractice() {
            if (window.audioManager) {
                window.audioManager.playTonePractice();
            }
        }

        function playRandomPinyin() {
            const allPinyin = [...pinyinData.shengmu, ...pinyinData.yunmu, 'mÄ', 'mÃ¡', 'mÇ', 'mÃ '];
            const randomPinyin = allPinyin[Math.floor(Math.random() * allPinyin.length)];
            playPinyin(randomPinyin);
        }

        function stopAllAudio() {
            if (window.audioManager) {
                window.audioManager.stopCurrent();
                document.getElementById('nowPlaying').innerHTML = 
                    '<i class="fas fa-stop-circle"></i> å·²åœæ­¢æ‰€æœ‰æ’­æ”¾';
            }
        }

        // ==================== å½•éŸ³åŠŸèƒ½ ====================
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];

        async function toggleRecording() {
            const btn = document.getElementById('recordBtn');
            const text = document.getElementById('recordText');
            const status = document.getElementById('recordStatus');
            
            if (!isRecording) {
                // å¼€å§‹å½•éŸ³
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            sampleRate: 44100
                        }
                    });
                    
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = event => {
                        if (event.data.size > 0) {
                            audioChunks.push(event.data);
                        }
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        const audioElement = document.getElementById('userRecording');
                        
                        audioElement.src = audioUrl;
                        audioElement.style.display = 'block';
                        
                        // åœæ­¢æ‰€æœ‰éŸ³é¢‘æµ
                        stream.getTracks().forEach(track => track.stop());
                        
                        status.innerHTML = '<i class="fas fa-check-circle"></i> å½•éŸ³å®Œæˆï¼ç‚¹å‡»æ’­æ”¾æŒ‰é’®æ”¶å¬æ‚¨çš„å½•éŸ³';
                        status.style.color = 'var(--success-audio)';
                    };
                    
                    mediaRecorder.onerror = (event) => {
                        console.error('å½•éŸ³é”™è¯¯:', event);
                        status.innerHTML = '<i class="fas fa-exclamation-triangle"></i> å½•éŸ³å¤±è´¥ï¼Œè¯·é‡è¯•';
                        status.style.color = 'var(--danger-audio)';
                    };
                    
                    mediaRecorder.start();
                    isRecording = true;
                    
                    // æ›´æ–°UI
                    btn.innerHTML = '<i class="fas fa-stop-circle"></i> åœæ­¢å½•éŸ³';
                    text.textContent = 'åœæ­¢å½•éŸ³';
                    btn.classList.add('stop');
                    status.innerHTML = '<i class="fas fa-circle" style="color: red; animation: blink 1s infinite;"></i> æ­£åœ¨å½•éŸ³...';
                    status.style.color = 'var(--danger-audio)';
                    
                    // æ·»åŠ é—ªçƒåŠ¨ç”»
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes blink {
                            0%, 100% { opacity: 1; }
                            50% { opacity: 0.5; }
                        }
                    `;
                    document.head.appendChild(style);
                    
                } catch (err) {
                    console.error('å½•éŸ³å¤±è´¥:', err);
                    status.innerHTML = `<i class="fas fa-exclamation-triangle"></i> æ— æ³•è®¿é—®éº¦å…‹é£: ${err.message}`;
                    status.style.color = 'var(--danger-audio)';
                    
                    // å›é€€åˆ°æç¤º
                    alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·ç¡®ä¿å·²æˆäºˆå½•éŸ³æƒé™ã€‚\n\næ‚¨å¯ä»¥ç»§ç»­ç‚¹å‡»æ‹¼éŸ³è¿›è¡Œå¬éŸ³å­¦ä¹ ã€‚');
                }
            } else {
                // åœæ­¢å½•éŸ³
                if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                    mediaRecorder.stop();
                }
                
                isRecording = false;
                btn.innerHTML = '<i class="fas fa-microphone"></i> å¼€å§‹å½•éŸ³';
                text.textContent = 'å¼€å§‹å½•éŸ³';
                btn.classList.remove('stop');
            }
        }

        // ==================== é”®ç›˜å¿«æ·é”® ====================
        document.addEventListener('keydown', function(event) {
            // ç©ºæ ¼é”®åœæ­¢æ’­æ”¾
            if (event.code === 'Space') {
                event.preventDefault();
                stopAllAudio();
            }
            // ESCé”®åœæ­¢å½•éŸ³
            if (event.code === 'Escape' && isRecording) {
                toggleRecording();
            }
            // Ré”®éšæœºæ’­æ”¾
            if (event.code === 'KeyR' && event.ctrlKey) {
                playRandomPinyin();
            }
        });

        // ==================== æœåŠ¡Workerï¼ˆå¢å¼ºä½“éªŒï¼‰ ====================
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(err => {
                console.log('Service Worker æ³¨å†Œå¤±è´¥:', err);
            });
        }
    </script>
</body>
</html>
EOFcat > index.html << 'EOF'
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹¼éŸ³å­¦ä¹ åŠ©æ‰‹ - äº’åŠ¨éŸ³é¢‘ç‰ˆ</title>
    <link rel="stylesheet" href="css/audio-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“¢</text></svg>">
</head>
<body>
    <div class="audio-container">
        <!-- å¤´éƒ¨ -->
        <header class="audio-header">
            <h1 class="audio-title">
                <i class="fas fa-volume-up"></i>
                æ‹¼éŸ³å­¦ä¹ åŠ©æ‰‹
                <i class="fas fa-headphones"></i>
            </h1>
            <p class="audio-subtitle">ç‚¹å‡»ä»»æ„æ‹¼éŸ³å³å¯å¬åˆ°æ ‡å‡†å‘éŸ³ ğŸ”Š æ”¯æŒå½•éŸ³å¯¹æ¯”è·Ÿè¯»</p>
        </header>

        <!-- éŸ³é¢‘æ§åˆ¶é¢æ¿ -->
        <section class="audio-control-panel">
            <h2 class="control-title">
                <i class="fas fa-sliders-h"></i>
                éŸ³é¢‘æ§åˆ¶ä¸­å¿ƒ
            </h2>
            
            <div class="control-buttons">
                <button class="control-btn" onclick="playAllShengmu()">
                    <i class="fas fa-play-circle"></i>
                    æ’­æ”¾æ‰€æœ‰å£°æ¯
                </button>
                <button class="control-btn" onclick="playTonePractice()">
                    <i class="fas fa-music"></i>
                    å£°è°ƒç»ƒä¹  (mÄ mÃ¡ mÇ mÃ )
                </button>
                <button class="control-btn" onclick="playRandomPinyin()">
                    <i class="fas fa-random"></i>
                    éšæœºæ’­æ”¾æ‹¼éŸ³
                </button>
                <button class="control-btn record" onclick="toggleRecording()" id="recordBtn">
                    <i class="fas fa-microphone"></i>
                    <span id="recordText">å¼€å§‹å½•éŸ³</span>
                </button>
                <button class="control-btn stop" onclick="stopAllAudio()">
                    <i class="fas fa-stop-circle"></i>
                    åœæ­¢æ’­æ”¾
                </button>
            </div>
            
            <div class="now-playing" id="nowPlaying">
                <i class="fas fa-volume-up"></i> å‡†å¤‡æ’­æ”¾æ‹¼éŸ³...
            </div>
            
            <div class="audio-tip">
                <i class="fas fa-lightbulb"></i> 
                <strong>ä½¿ç”¨æç¤ºï¼š</strong> é¦–æ¬¡ä½¿ç”¨å¯èƒ½éœ€è¦å…è®¸æµè§ˆå™¨æ’­æ”¾å£°éŸ³ã€‚å»ºè®®ä½¿ç”¨ Chrome/Edge æµè§ˆå™¨è·å¾—æœ€ä½³ä½“éªŒã€‚
            </div>
        </section>

        <!-- å£°æ¯å‘éŸ³åŒº -->
        <section class="pinyin-section">
            <h2 class="section-title">
                <i class="fas fa-volume-up"></i>
                å£°æ¯å‘éŸ³ (21ä¸ª)
            </h2>
            <p>ç‚¹å‡»ä¸‹æ–¹å£°æ¯æŒ‰é’®å³å¯å¬åˆ°å‘éŸ³ï¼š</p>
            <div class="pinyin-grid" id="shengmuGrid">
                <!-- åŠ¨æ€ç”Ÿæˆå£°æ¯æŒ‰é’® -->
            </div>
        </section>

        <!-- éŸµæ¯å‘éŸ³åŒº -->
        <section class="pinyin-section">
            <h2 class="section-title">
                <i class="fas fa-music"></i>
                éŸµæ¯å‘éŸ³
            </h2>
            <p>ç‚¹å‡»ä¸‹æ–¹éŸµæ¯æŒ‰é’®å³å¯å¬åˆ°å‘éŸ³ï¼š</p>
            <div class="pinyin-grid" id="yunmuGrid">
                <!-- åŠ¨æ€ç”ŸæˆéŸµæ¯æŒ‰é’® -->
            </div>
        </section>

        <!-- å£°è°ƒç»ƒä¹ åŒº -->
        <section class="pinyin-section">
            <h2 class="section-title">
                <i class="fas fa-chart-line"></i>
                å››å£°è°ƒç»ƒä¹ 
            </h2>
            <p>ç‚¹å‡»ç»ƒä¹ å››ä¸ªå£°è°ƒï¼Œä½“ä¼šå£°è°ƒå˜åŒ–ï¼š</p>
            <div class="tone-buttons">
                <button class="tone-btn" onclick="playPinyin('mÄ')">mÄ <br><small>ç¬¬ä¸€å£°</small></button>
                <button class="tone-btn" onclick="playPinyin('mÃ¡')">mÃ¡ <br><small>ç¬¬äºŒå£°</small></button>
                <button class="tone-btn" onclick="playPinyin('mÇ')">mÇ <br><small>ç¬¬ä¸‰å£°</small></button>
                <button class="tone-btn" onclick="playPinyin('mÃ ')">mÃ  <br><small>ç¬¬å››å£°</small></button>
            </div>
        </section>

        <!-- å¸¸ç”¨è¯å‘éŸ³ -->
        <section class="pinyin-section">
            <h2 class="section-title">
                <i class="fas fa-comments"></i>
                å¸¸ç”¨è¯å‘éŸ³
            </h2>
            <p>ç‚¹å‡»å­¦ä¹ å¸¸ç”¨æ±‰è¯­è¯æ±‡çš„å‘éŸ³ï¼š</p>
            <div class="words-grid">
                <button class="word-btn" onclick="playWord('ä½ å¥½')">ä½ å¥½</button>
                <button class="word-btn" onclick="playWord('è°¢è°¢')">è°¢è°¢</button>
                <button class="word-btn" onclick="playWord('å†è§')">å†è§</button>
                <button class="word-btn" onclick="playWord('æˆ‘çˆ±ä½ ')">æˆ‘çˆ±ä½ </button>
                <button class="word-btn" onclick="playWord('æ—©ä¸Šå¥½')">æ—©ä¸Šå¥½</button>
                <button class="word-btn" onclick="playWord('å¯¹ä¸èµ·')">å¯¹ä¸èµ·</button>
                <button class="word-btn" onclick="playWord('æ²¡å…³ç³»')">æ²¡å…³ç³»</button>
                <button class="word-btn" onclick="playWord('è€å¸ˆå¥½')">è€å¸ˆå¥½</button>
            </div>
        </section>

        <!-- å½•éŸ³å¯¹æ¯”åŒº -->
        <section class="record-section">
            <h2 class="section-title">
                <i class="fas fa-microphone-alt"></i>
                å½•éŸ³è·Ÿè¯»ç»ƒä¹ 
            </h2>
            <p>ç‚¹å‡»"å¼€å§‹å½•éŸ³"æŒ‰é’®ï¼Œè·Ÿè¯»æ‹¼éŸ³ï¼Œç„¶åæ’­æ”¾å¯¹æ¯”æ‚¨çš„å‘éŸ³ï¼š</p>
            
            <div class="waveform" id="waveform">
                <!-- åŠ¨æ€ç”Ÿæˆæ³¢å½¢ -->
            </div>
            
            <div id="recordStatus" style="text-align: center; margin: 15px 0; color: var(--primary-audio);">
                <i class="fas fa-info-circle"></i> å‡†å¤‡å½•éŸ³...
            </div>
            
            <audio id="userRecording" controls style="width: 100%; margin-top: 10px;"></audio>
            
            <div class="audio-tip">
                <i class="fas fa-graduation-cap"></i>
                <strong>å­¦ä¹ å»ºè®®ï¼š</strong> å…ˆå¬æ ‡å‡†å‘éŸ³ï¼Œç„¶åå½•éŸ³è·Ÿè¯»ï¼Œå¯¹æ¯”æ”¹è¿›ã€‚æ¯å¤©ç»ƒä¹ 10åˆ†é’Ÿæ•ˆæœæœ€ä½³ï¼
            </div>
        </section>

        <!-- é¡µè„š -->
        <footer class="audio-footer">
            <p>ğŸ¯ æ‹¼éŸ³å­¦ä¹ åŠ©æ‰‹ - äº’åŠ¨éŸ³é¢‘ç‰ˆ v1.0</p>
            <p>ğŸ“ æŠ€æœ¯æ”¯æŒï¼šæµè§ˆå™¨è¯­éŸ³åˆæˆ(TTS) | ğŸµ æ‰€æœ‰å‘éŸ³å‡ä¸ºå®æ—¶ç”Ÿæˆ</p>
            <p>â­ æç¤ºï¼šå¦‚æœå¬ä¸åˆ°å£°éŸ³ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®å¹¶å…è®¸æ’­æ”¾å£°éŸ³</p>
        </footer>
    </div>

    <!-- è„šæœ¬ -->
    <script src="js/audio-manager.js"></script>
    <script>
        // ==================== åˆå§‹åŒ–æ‹¼éŸ³æ•°æ® ====================
        const pinyinData = {
            shengmu: [
                'b', 'p', 'm', 'f', 'd', 't', 'n', 'l', 
                'g', 'k', 'h', 'j', 'q', 'x', 
                'zh', 'ch', 'sh', 'r', 'z', 'c', 's'
            ],
            yunmu: [
                'a', 'o', 'e', 'i', 'u', 'Ã¼', 
                'ai', 'ei', 'ao', 'ou', 
                'an', 'en', 'in', 'un', 'Ã¼n',
                'ang', 'eng', 'ing', 'ong'
            ]
        };

        // ==================== åˆå§‹åŒ–é¡µé¢ ====================
        document.addEventListener('DOMContentLoaded', function() {
            initPinyinButtons();
            initWaveform();
            initSpeechSynthesis();
            
            // æ˜¾ç¤ºæ¬¢è¿æç¤º
            setTimeout(() => {
                document.getElementById('nowPlaying').innerHTML = 
                    '<i class="fas fa-hand-pointer"></i> ç‚¹å‡»ä¸Šæ–¹ä»»æ„æ‹¼éŸ³å¼€å§‹å­¦ä¹ ï¼';
            }, 1000);
        });

        // åˆå§‹åŒ–æ‹¼éŸ³æŒ‰é’®
        function initPinyinButtons() {
            // ç”Ÿæˆå£°æ¯æŒ‰é’®
            const shengmuGrid = document.getElementById('shengmuGrid');
            shengmuGrid.innerHTML = pinyinData.shengmu.map(pinyin => `
                <button class="pinyin-btn" onclick="playPinyin('${pinyin}')">
                    ${pinyin}
                </button>
            `).join('');
            
            // ç”ŸæˆéŸµæ¯æŒ‰é’®
            const yunmuGrid = document.getElementById('yunmuGrid');
            yunmuGrid.innerHTML = pinyinData.yunmu.map(pinyin => `
                <button class="pinyin-btn" onclick="playPinyin('${pinyin}')">
                    ${pinyin}
                </button>
            `).join('');
        }

        // åˆå§‹åŒ–æ³¢å½¢å›¾
        function initWaveform() {
            const waveform = document.getElementById('waveform');
            for (let i = 0; i < 40; i++) {
                const bar = document.createElement('div');
                bar.className = 'wave-bar';
                bar.style.left = `${i * 2.5}%`;
                bar.style.animationDelay = `${i * 0.05}s`;
                waveform.appendChild(bar);
            }
        }

        // åˆå§‹åŒ–è¯­éŸ³åˆæˆ
        function initSpeechSynthesis() {
            if ('speechSynthesis' in window) {
                // é¢„åŠ è½½è¯­éŸ³
                speechSynthesis.getVoices();
                console.log('è¯­éŸ³åˆæˆå·²å°±ç»ª');
            } else {
                console.warn('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ');
                document.querySelector('.audio-tip').innerHTML += 
                    '<br><strong style="color: red;">âš ï¸ å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆï¼Œè¯·ä½¿ç”¨ Chrome æˆ– Edge æµè§ˆå™¨ã€‚</strong>';
            }
        }

        // ==================== éŸ³é¢‘æ§åˆ¶å‡½æ•° ====================
        function playPinyin(pinyin) {
            if (window.audioManager) {
                window.audioManager.playPinyin(pinyin);
            }
        }

        function playWord(word) {
            playPinyin(word);
        }

        function playAllShengmu() {
            if (window.audioManager) {
                window.audioManager.playAllShengmu();
            }
        }

        function playTonePractice() {
            if (window.audioManager) {
                window.audioManager.playTonePractice();
            }
        }

        function playRandomPinyin() {
            const allPinyin = [...pinyinData.shengmu, ...pinyinData.yunmu, 'mÄ', 'mÃ¡', 'mÇ', 'mÃ '];
            const randomPinyin = allPinyin[Math.floor(Math.random() * allPinyin.length)];
            playPinyin(randomPinyin);
        }

        function stopAllAudio() {
            if (window.audioManager) {
                window.audioManager.stopCurrent();
                document.getElementById('nowPlaying').innerHTML = 
                    '<i class="fas fa-stop-circle"></i> å·²åœæ­¢æ‰€æœ‰æ’­æ”¾';
            }
        }

        // ==================== å½•éŸ³åŠŸèƒ½ ====================
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];

        async function toggleRecording() {
            const btn = document.getElementById('recordBtn');
            const text = document.getElementById('recordText');
            const status = document.getElementById('recordStatus');
            
            if (!isRecording) {
                // å¼€å§‹å½•éŸ³
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            sampleRate: 44100
                        }
                    });
                    
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = event => {
                        if (event.data.size > 0) {
                            audioChunks.push(event.data);
                        }
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        const audioElement = document.getElementById('userRecording');
                        
                        audioElement.src = audioUrl;
                        audioElement.style.display = 'block';
                        
                        // åœæ­¢æ‰€æœ‰éŸ³é¢‘æµ
                        stream.getTracks().forEach(track => track.stop());
                        
                        status.innerHTML = '<i class="fas fa-check-circle"></i> å½•éŸ³å®Œæˆï¼ç‚¹å‡»æ’­æ”¾æŒ‰é’®æ”¶å¬æ‚¨çš„å½•éŸ³';
                        status.style.color = 'var(--success-audio)';
                    };
                    
                    mediaRecorder.onerror = (event) => {
                        console.error('å½•éŸ³é”™è¯¯:', event);
                        status.innerHTML = '<i class="fas fa-exclamation-triangle"></i> å½•éŸ³å¤±è´¥ï¼Œè¯·é‡è¯•';
                        status.style.color = 'var(--danger-audio)';
                    };
                    
                    mediaRecorder.start();
                    isRecording = true;
                    
                    // æ›´æ–°UI
                    btn.innerHTML = '<i class="fas fa-stop-circle"></i> åœæ­¢å½•éŸ³';
                    text.textContent = 'åœæ­¢å½•éŸ³';
                    btn.classList.add('stop');
                    status.innerHTML = '<i class="fas fa-circle" style="color: red; animation: blink 1s infinite;"></i> æ­£åœ¨å½•éŸ³...';
                    status.style.color = 'var(--danger-audio)';
                    
                    // æ·»åŠ é—ªçƒåŠ¨ç”»
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes blink {
                            0%, 100% { opacity: 1; }
                            50% { opacity: 0.5; }
                        }
                    `;
                    document.head.appendChild(style);
                    
                } catch (err) {
                    console.error('å½•éŸ³å¤±è´¥:', err);
                    status.innerHTML = `<i class="fas fa-exclamation-triangle"></i> æ— æ³•è®¿é—®éº¦å…‹é£: ${err.message}`;
                    status.style.color = 'var(--danger-audio)';
                    
                    // å›é€€åˆ°æç¤º
                    alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·ç¡®ä¿å·²æˆäºˆå½•éŸ³æƒé™ã€‚\n\næ‚¨å¯ä»¥ç»§ç»­ç‚¹å‡»æ‹¼éŸ³è¿›è¡Œå¬éŸ³å­¦ä¹ ã€‚');
                }
            } else {
                // åœæ­¢å½•éŸ³
                if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                    mediaRecorder.stop();
                }
                
                isRecording = false;
                btn.innerHTML = '<i class="fas fa-microphone"></i> å¼€å§‹å½•éŸ³';
                text.textContent = 'å¼€å§‹å½•éŸ³';
                btn.classList.remove('stop');
            }
        }

        // ==================== é”®ç›˜å¿«æ·é”® ====================
        document.addEventListener('keydown', function(event) {
            // ç©ºæ ¼é”®åœæ­¢æ’­æ”¾
            if (event.code === 'Space') {
                event.preventDefault();
                stopAllAudio();
            }
            // ESCé”®åœæ­¢å½•éŸ³
            if (event.code === 'Escape' && isRecording) {
                toggleRecording();
            }
            // Ré”®éšæœºæ’­æ”¾
            if (event.code === 'KeyR' && event.ctrlKey) {
                playRandomPinyin();
            }
        });

        // ==================== æœåŠ¡Workerï¼ˆå¢å¼ºä½“éªŒï¼‰ ====================
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(err => {
                console.log('Service Worker æ³¨å†Œå¤±è´¥:', err);
            });
        }
    </script>
</body>
</html>
